
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>XAU PREDATOR â€“ FUTURES DATA ENGINE</title>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<style>
:root{
  --bg:#050505;--card:#111;--text:#eee;--accent:#00ffff;
  --wait:#444;--arming:#ffcc00;--enter:#00ff66;--locked:#ff4444;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:Consolas,monospace;height:100vh;overflow:hidden;
  display:flex;flex-direction:column;padding:8px;
}
.grid{display:grid;grid-template-rows:1fr auto;gap:8px;height:100%}
.box{background:var(--card);border:1px solid #333;border-radius:8px;overflow:hidden;position:relative}
#chart{width:100%;height:100%}
.ind{position:absolute;bottom:0;left:0;height:4px;width:100%;background:var(--wait);z-index:10}
.sidebar{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.card{background:#000;border:1px solid #222;border-radius:6px;padding:8px;text-align:center}
.label{font-size:10px;color:#666;text-transform:uppercase}
.val{font-size:18px;font-weight:bold}
#price{font-size:28px;color:var(--accent)}
#reason{grid-column:span 2;color:var(--arming);min-height:36px;display:flex;align-items:center;justify-content:center;font-size:11px}
#log{grid-column:span 2;height:80px;overflow-y:auto;font-size:11px;color:#00ff66;background:#050505;padding:4px;border:1px solid #222}
.btns{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:6px}
.btn{padding:14px;border:none;border-radius:6px;font-weight:bold;color:#fff;opacity:.15;transition:0.2s}
.buy{background:#00ff66;color:#000}
.sell{background:#ff4444;color:#fff}
.active{opacity:1;box-shadow:0 0 15px currentColor;border:2px solid #fff}
</style>
</head>
<body>
<div class="grid">
  <div class="box"><div id="chart"></div><div id="ind" class="ind"></div></div>
  <div class="sidebar">
    <div class="card" style="grid-column:span 2">
      <div id="price" class="val">0.00</div>
      <div id="raw" style="font-size:10px;color:#444">RAW: 0.0000</div>
    </div>
    <div class="card"><div class="label">Bias</div><div id="bias" class="val">-</div></div>
    <div class="card"><div class="label">State</div><div id="state" class="val">WAIT</div></div>
    <div id="reason" class="card">WAITING STREAM...</div>
    <div id="log" class="card"></div>
    <div class="btns">
      <button id="buyBtn" class="btn buy">BUY</button>
      <button id="sellBtn" class="btn sell">SELL</button>
    </div>
  </div>
</div>

<script>
/* ================= LOGISTIK BARU (FUTURES) ================= */
const WS_URL = "wss://fstream.binance.com/ws/paxgusdt@trade";
let ws, lastTick=0, state="WAIT", rawHigh=0, rawLow=0, smoothPrice=0;
let missions = { h1:0, m15:0, m5:0, m1:0 };

const priceEl=document.getElementById("price"), rawEl=document.getElementById("raw"),
      biasEl=document.getElementById("bias"), stateEl=document.getElementById("state"),
      reasonEl=document.getElementById("reason"), logEl=document.getElementById("log"),
      indEl=document.getElementById("ind");

/* ================= CHART ================= */
const chart = LightweightCharts.createChart(document.getElementById("chart"),{
  layout:{backgroundColor:"#050505",textColor:"#d1d4dc"},
  grid:{vertLines:{color:"#111"},horzLines:{color:"#111"}},
  timeScale:{timeVisible:true,secondsVisible:true}
});
const candle = chart.addCandlestickSeries();
const mH1 = chart.addLineSeries({color:"#bf00ff",lineWidth:2,title:'H1'});
const mM15 = chart.addLineSeries({color:"#ffff00",lineWidth:2,title:'M15'});
const mM5 = chart.addLineSeries({color:"#00ff00",lineWidth:2,title:'M5'});
const mM1 = chart.addLineSeries({color:"#ffffff",lineWidth:2,title:'M1'});

function logMsg(m){
  const d=document.createElement("div");
  d.textContent=`[${new Date().toLocaleTimeString()}] ${m}`;
  logEl.prepend(d);
}

/* ================= ENGINE ================= */
function updateEngine(raw){
  smoothPrice = smoothPrice ? smoothPrice*0.8 + raw*0.2 : raw;
  if(!rawHigh || smoothPrice > rawHigh) rawHigh = smoothPrice;
  if(!rawLow || smoothPrice < rawLow) rawLow = smoothPrice;

  // Mission Price Logic
  const range = rawHigh - rawLow;
  missions.h1 = rawHigh + 0.3;  // Bright Purple
  missions.m15 = rawLow + (range * 0.75); // Bright Yellow
  missions.m5 = rawLow + (range * 0.25);  // Bright Green
  missions.m1 = (rawHigh + rawLow) / 2;   // Bright White

  let bias = smoothPrice > missions.m1 ? "BUY" : "SELL";
  
  // Logic "Galak" (Aggressive State)
  const target = bias === "BUY" ? missions.m15 : missions.m5;
  if(Math.abs(smoothPrice - target) < 0.08) state = "ENTER";
  else if(Math.abs(smoothPrice - target) < 0.15) state = "ARMING";
  else state = "WAIT";

  // UI Updates
  priceEl.textContent = raw.toFixed(2);
  rawEl.textContent = "RAW: " + raw.toFixed(4);
  biasEl.textContent = bias;
  biasEl.style.color = bias === "BUY" ? "#00ff66" : "#ff4444";
  stateEl.textContent = state;
  indEl.style.background = `var(--${state.toLowerCase()})`;
  reasonEl.textContent = state === "ENTER" ? "MISSION ZONE ACHIEVED" : "SCANNING HABIT...";
  
  document.getElementById("buyBtn").className = `btn buy ${state==="ENTER"&&bias==="BUY"?"active":""}`;
  document.getElementById("sellBtn").className = `btn sell ${state==="ENTER"&&bias==="SELL"?"active":""}`;

  const t = Math.floor(Date.now()/1000);
  mH1.setData([{time:t-60,value:missions.h1},{time:t+10,value:missions.h1}]);
  mM15.setData([{time:t-60,value:missions.m15},{time:t+10,value:missions.m15}]);
  mM5.setData([{time:t-60,value:missions.m5},{time:t+10,value:missions.m5}]);
  mM1.setData([{time:t-60,value:missions.m1},{time:t+10,value:missions.m1}]);
}

function connect(){
  ws=new WebSocket(WS_URL);
  ws.onopen=()=>{ logMsg("WS CONNECTED (FUTURES)"); };
  ws.onmessage=e=>{
    const d=JSON.parse(e.data);
    lastTick=Date.now();
    updateEngine(parseFloat(d.p));
  };
  ws.onclose=()=>{ logMsg("WS CLOSED. RETRYING..."); setTimeout(connect,2000); };
}

/* ================= INIT ================= */
fetch("https://fapi.binance.com/fapi/v1/klines?symbol=PAXGUSDT&interval=1m&limit=100")
.then(r=>r.json()).then(d=>{
  candle.setData(d.map(x=>({time:x[0]/1000,open:+x[1],high:+x[2],low:+x[3],close:+x[4]})));
  logMsg("HISTORY LOADED"); 
  connect();
});

window.addEventListener("resize",()=>chart.resize(document.getElementById("chart").clientWidth, document.getElementById("chart").clientHeight));
</script>
</body>
</html>
